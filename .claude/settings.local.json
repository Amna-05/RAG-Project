{
  "permissions": {
    "allow": [
      "Bash(git fetch:*)",
      "Bash(bash:*)",
      "WebSearch",
      "Skill(speckit.implement)",
      "Bash(git rev-parse:*)",
      "Bash(uv sync:*)",
      "Bash(python:*)",
      "Bash(set PYTHONPATH=src:*)",
      "Bash(PYTHONPATH=src python:*)",
      "Bash(uv run python:*)",
      "Bash(uv run pytest:*)",
      "Bash(uv add:*)",
      "Bash(git add:*)",
      "Bash(git commit:*)",
      "Skill(speckit.specify)",
      "Bash(cat:*)",
      "Bash(powershell -Command \"Get-Content tasks.md | Select-Object -First 5\")",
      "Bash(powershell -Command \"\n@''\n## Phase 4: User Story 2 - Password Reset \\(Priority: P1\\)\n\n**Goal**: Implement secure password reset flow via email\n\n**Independent Test**: Request reset -> receive email -> click link -> set new password -> login works\n\n### Tests for User Story 2\n\n- [ ] T031 [P] [US2] Create unit tests for token generation/validation in tests/unit/test_password_reset.py\n- [ ] T032 [P] [US2] Create unit tests for email service in tests/unit/test_email_service.py\n- [ ] T033 [US2] Create integration test for full reset flow in tests/integration/test_password_reset_flow.py\n\n### Implementation for User Story 2\n\n- [ ] T034 [US2] Create EmailService with Resend integration in src/rag/services/email_service.py\n- [ ] T035 [US2] Create password reset email template in src/rag/templates/password_reset_email.html\n- [ ] T036 [US2] Create PasswordResetService in src/rag/services/password_reset_service.py\n- [ ] T037 [US2] Implement token generation \\(32 bytes, SHA-256 hash\\) in src/rag/services/password_reset_service.py\n- [ ] T038 [US2] Implement token validation \\(1-hour expiry check\\) in src/rag/services/password_reset_service.py\n- [ ] T039 [US2] Invalidate previous tokens when new one requested in src/rag/services/password_reset_service.py\n- [ ] T040 [US2] Create forgot-password endpoint in src/rag/api/v1/auth.py\n- [ ] T041 [US2] Create reset-password endpoint in src/rag/api/v1/auth.py\n- [ ] T042 [US2] Create verify-reset-token endpoint in src/rag/api/v1/auth.py\n- [ ] T043 [US2] Add rate limiting \\(3/hour\\) to password reset endpoints in src/rag/api/v1/auth.py\n\n**Checkpoint**: Password reset flow complete\n\n---\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(powershell -Command \"\n@''\n\n## Phase 5: User Story 3 - Structured Logging & Metrics \\(Priority: P2\\)\n\n**Goal**: Implement JSON structured logging with request correlation\n\n**Independent Test**: Make API request -> verify JSON log entry with request_id, user_id, duration\n\n### Tests for User Story 3\n\n- [ ] T044 [P] [US3] Create unit tests for log formatting in tests/unit/test_logging.py\n- [ ] T045 [P] [US3] Create unit tests for sensitive data filtering in tests/unit/test_logging.py\n- [ ] T046 [US3] Create integration test for request logging in tests/integration/test_request_logging.py\n\n### Implementation for User Story 3\n\n- [ ] T047 [US3] Create structured logging setup with structlog in src/rag/core/logging.py\n- [ ] T048 [US3] Implement JSON formatter with configurable output in src/rag/core/logging.py\n- [ ] T049 [US3] Implement sensitive data filtering \\(passwords, tokens\\) in src/rag/core/logging.py\n- [ ] T050 [US3] Create request ID middleware in src/rag/middleware/request_id.py\n- [ ] T051 [US3] Create logging middleware in src/rag/middleware/logging.py\n- [ ] T052 [US3] Add request logging to database \\(RequestLog model\\) in src/rag/middleware/logging.py\n- [ ] T053 [US3] Create MetricsService for counter/gauge tracking in src/rag/services/metrics_service.py\n- [ ] T054 [US3] Implement 30-day log retention cleanup in src/rag/services/metrics_service.py\n- [ ] T055 [US3] Add logging configuration to settings in src/rag/core/config.py\n- [ ] T056 [US3] Integrate logging into main.py lifespan in src/rag/main.py\n\n**Checkpoint**: Structured logging operational\n\n---\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(powershell -Command \"\n@''\n\n## Phase 6: User Story 4 - Graceful Degradation \\(Priority: P2\\)\n\n**Goal**: Implement fallback behavior for external service failures\n\n**Independent Test**: Disable primary LLM -> verify fallback activates -> user gets response\n\n### Tests for User Story 4\n\n- [ ] T057 [P] [US4] Create unit tests for LLM fallback logic in tests/unit/test_llm_fallback.py\n- [ ] T058 [US4] Create integration test for degradation scenarios in tests/integration/test_graceful_degradation.py\n\n### Implementation for User Story 4\n\n- [ ] T059 [US4] Implement retry-once logic in LLM service in src/rag/services/llm_service.py\n- [ ] T060 [US4] Implement fallback to alternative provider in src/rag/services/llm_service.py\n- [ ] T061 [US4] Add error logging for LLM failures in src/rag/services/llm_service.py\n\n**Checkpoint**: Graceful degradation working\n\n---\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(powershell -Command \"\n@''\n\n## Phase 7: User Story 5 - Test Coverage \\(Priority: P2\\)\n\n**Goal**: Achieve 80% test coverage on critical modules\n\n**Independent Test**: Run pytest --cov -> verify 80%+ on documents.py, embeddings.py, auth_service.py, search_service.py\n\n### Tests for User Story 5\n\n- [ ] T062 [P] [US5] Add edge case tests for documents.py in tests/unit/test_documents.py\n- [ ] T063 [P] [US5] Add edge case tests for embeddings.py in tests/unit/test_embeddings.py\n- [ ] T064 [P] [US5] Add edge case tests for auth_service.py in tests/unit/test_auth_service.py\n- [ ] T065 [P] [US5] Add edge case tests for search_service.py in tests/unit/test_search_service.py\n- [ ] T066 [US5] Configure pytest-cov with coverage thresholds in pyproject.toml\n- [ ] T067 [US5] Add coverage reporting to pytest configuration in pyproject.toml\n- [ ] T068 [US5] Verify 80% coverage achieved, add missing tests if needed\n\n**Checkpoint**: 80% test coverage achieved\n\n---\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(powershell -Command \"\n@''\n\n## Phase 8: User Story 6 - Docker Deployment \\(Priority: P3\\)\n\n**Goal**: Create production-ready Docker configuration\n\n**Independent Test**: docker-compose up -> health check passes -> API responds\n\n### Implementation for User Story 6\n\n- [ ] T069 [US6] Update Dockerfile with multi-stage build in Dockerfile\n- [ ] T070 [US6] Configure non-root user in Dockerfile\n- [ ] T071 [US6] Update docker-compose.yml with production settings in docker-compose.yml\n- [ ] T072 [US6] Add health check endpoint configuration in src/rag/main.py\n- [ ] T073 [US6] Create Railway deployment configuration in railway.toml\n- [ ] T074 [US6] Document deployment process in specs/002-backend-production-readiness/quickstart.md\n\n**Checkpoint**: Docker deployment ready\n\n---\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(powershell -Command \"\n@''\n\n## Phase 9: Polish & Cross-Cutting Concerns\n\n**Purpose**: Final integration, documentation, and cleanup\n\n- [ ] T075 Update main.py to wire all new services in src/rag/main.py\n- [ ] T076 Update API router to include new endpoints in src/rag/api/v1/__init__.py\n- [ ] T077 Run full test suite and verify all tests pass\n- [ ] T078 Run coverage report and verify 80% threshold met\n- [ ] T079 Update CLAUDE.md with new features and endpoints\n\n**Checkpoint**: Feature complete and production-ready\n\n---\n\n## Dependencies & Execution Order\n\nPhase 1 \\(Setup\\) and Phase 2 \\(Foundational\\) must complete first.\nAfter Phase 2, US1-US5 can be implemented in any order or in parallel.\nPhase 8 \\(Docker\\) depends on implementation being complete.\nPhase 9 \\(Polish\\) runs last.\n\n**User Story Independence**: After Phase 2, US1-US5 can be implemented in any order or in parallel by different developers. US6 \\(Docker\\) depends on implementation being complete.\n\n---\n\n## Summary\n\n| Phase | User Story | Tasks | Parallel | Description |\n|-------|------------|-------|----------|-------------|\n| 1 | Setup | 4 | 2 | Dependencies and configuration |\n| 2 | Foundational | 15 | 12 | Migrations, models, schemas, mocks |\n| 3 | US1 | 11 | 3 | Hybrid BM25 + semantic search |\n| 4 | US2 | 13 | 2 | Password reset via email |\n| 5 | US3 | 13 | 2 | Structured logging & metrics |\n| 6 | US4 | 5 | 1 | Graceful degradation |\n| 7 | US5 | 7 | 4 | 80% test coverage |\n| 8 | US6 | 6 | 0 | Docker deployment |\n| 9 | Polish | 5 | 0 | Final integration |\n| **Total** | | **79** | **26** | |\n\n**MVP Scope**: Phase 1 + Phase 2 + Phase 3 \\(US1: Hybrid Search\\) = 30 tasks\n\n**Suggested Implementation Order**:\n1. Complete Setup and Foundational phases first\n2. Start with US1 \\(Hybrid Search\\) - highest user value\n3. Add US2 \\(Password Reset\\) - security critical\n4. Add US3 \\(Logging\\) - operational visibility\n5. Complete remaining stories as capacity allows\n''@ | Add-Content -Path tasks.md -Encoding UTF8\")",
      "Bash(ls:*)",
      "Bash(git checkout:*)",
      "Bash(uv run alembic upgrade:*)",
      "Bash(alembic current:*)",
      "Bash(uv run alembic:*)"
    ]
  },
  "outputStyle": "default"
}
